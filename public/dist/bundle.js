!function(t){var e={};function s(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/",s(s.s=1)}([function(t,e,s){var a;!function(n){var i=/^\s+/,r=/\s+$/,o=0,c=n.round,l=n.min,h=n.max,d=n.random;function p(t,e){if(e=e||{},(t=t||"")instanceof p)return t;if(!(this instanceof p))return new p(t,e);var s=function(t){var e={r:0,g:0,b:0},s=1,a=null,o=null,c=null,d=!1,p=!1;"string"==typeof t&&(t=function(t){t=t.replace(i,"").replace(r,"").toLowerCase();var e,s=!1;if(A[t])t=A[t],s=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};if(e=O.rgb.exec(t))return{r:e[1],g:e[2],b:e[3]};if(e=O.rgba.exec(t))return{r:e[1],g:e[2],b:e[3],a:e[4]};if(e=O.hsl.exec(t))return{h:e[1],s:e[2],l:e[3]};if(e=O.hsla.exec(t))return{h:e[1],s:e[2],l:e[3],a:e[4]};if(e=O.hsv.exec(t))return{h:e[1],s:e[2],v:e[3]};if(e=O.hsva.exec(t))return{h:e[1],s:e[2],v:e[3],a:e[4]};if(e=O.hex8.exec(t))return{r:H(e[1]),g:H(e[2]),b:H(e[3]),a:N(e[4]),format:s?"name":"hex8"};if(e=O.hex6.exec(t))return{r:H(e[1]),g:H(e[2]),b:H(e[3]),format:s?"name":"hex"};if(e=O.hex4.exec(t))return{r:H(e[1]+""+e[1]),g:H(e[2]+""+e[2]),b:H(e[3]+""+e[3]),a:N(e[4]+""+e[4]),format:s?"name":"hex8"};if(e=O.hex3.exec(t))return{r:H(e[1]+""+e[1]),g:H(e[2]+""+e[2]),b:H(e[3]+""+e[3]),format:s?"name":"hex"};return!1}(t));"object"==typeof t&&(K(t.r)&&K(t.g)&&K(t.b)?(u=t.r,v=t.g,f=t.b,e={r:255*$(u,255),g:255*$(v,255),b:255*$(f,255)},d=!0,p="%"===String(t.r).substr(-1)?"prgb":"rgb"):K(t.h)&&K(t.s)&&K(t.v)?(a=D(t.s),o=D(t.v),e=function(t,e,s){t=6*$(t,360),e=$(e,100),s=$(s,100);var a=n.floor(t),i=t-a,r=s*(1-e),o=s*(1-i*e),c=s*(1-(1-i)*e),l=a%6;return{r:255*[s,o,r,r,c,s][l],g:255*[c,s,s,o,r,r][l],b:255*[r,r,c,s,s,o][l]}}(t.h,a,o),d=!0,p="hsv"):K(t.h)&&K(t.s)&&K(t.l)&&(a=D(t.s),c=D(t.l),e=function(t,e,s){var a,n,i;function r(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t}if(t=$(t,360),e=$(e,100),s=$(s,100),0===e)a=n=i=s;else{var o=s<.5?s*(1+e):s+e-s*e,c=2*s-o;a=r(c,o,t+1/3),n=r(c,o,t),i=r(c,o,t-1/3)}return{r:255*a,g:255*n,b:255*i}}(t.h,a,c),d=!0,p="hsl"),t.hasOwnProperty("a")&&(s=t.a));var u,v,f;return s=R(s),{ok:d,format:t.format||p,r:l(255,h(e.r,0)),g:l(255,h(e.g,0)),b:l(255,h(e.b,0)),a:s}}(t);this._originalInput=t,this._r=s.r,this._g=s.g,this._b=s.b,this._a=s.a,this._roundA=c(100*this._a)/100,this._format=e.format||s.format,this._gradientType=e.gradientType,this._r<1&&(this._r=c(this._r)),this._g<1&&(this._g=c(this._g)),this._b<1&&(this._b=c(this._b)),this._ok=s.ok,this._tc_id=o++}function u(t,e,s){t=$(t,255),e=$(e,255),s=$(s,255);var a,n,i=h(t,e,s),r=l(t,e,s),o=(i+r)/2;if(i==r)a=n=0;else{var c=i-r;switch(n=o>.5?c/(2-i-r):c/(i+r),i){case t:a=(e-s)/c+(e<s?6:0);break;case e:a=(s-t)/c+2;break;case s:a=(t-e)/c+4}a/=6}return{h:a,s:n,l:o}}function v(t,e,s){t=$(t,255),e=$(e,255),s=$(s,255);var a,n,i=h(t,e,s),r=l(t,e,s),o=i,c=i-r;if(n=0===i?0:c/i,i==r)a=0;else{switch(i){case t:a=(e-s)/c+(e<s?6:0);break;case e:a=(s-t)/c+2;break;case s:a=(t-e)/c+4}a/=6}return{h:a,s:n,v:o}}function f(t,e,s,a){var n=[T(c(t).toString(16)),T(c(e).toString(16)),T(c(s).toString(16))];return a&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function m(t,e,s,a){return[T(q(a)),T(c(t).toString(16)),T(c(e).toString(16)),T(c(s).toString(16))].join("")}function g(t,e){e=0===e?0:e||10;var s=p(t).toHsl();return s.s-=e/100,s.s=F(s.s),p(s)}function _(t,e){e=0===e?0:e||10;var s=p(t).toHsl();return s.s+=e/100,s.s=F(s.s),p(s)}function b(t){return p(t).desaturate(100)}function y(t,e){e=0===e?0:e||10;var s=p(t).toHsl();return s.l+=e/100,s.l=F(s.l),p(s)}function w(t,e){e=0===e?0:e||10;var s=p(t).toRgb();return s.r=h(0,l(255,s.r-c(-e/100*255))),s.g=h(0,l(255,s.g-c(-e/100*255))),s.b=h(0,l(255,s.b-c(-e/100*255))),p(s)}function x(t,e){e=0===e?0:e||10;var s=p(t).toHsl();return s.l-=e/100,s.l=F(s.l),p(s)}function C(t,e){var s=p(t).toHsl(),a=(s.h+e)%360;return s.h=a<0?360+a:a,p(s)}function L(t){var e=p(t).toHsl();return e.h=(e.h+180)%360,p(e)}function S(t){var e=p(t).toHsl(),s=e.h;return[p(t),p({h:(s+120)%360,s:e.s,l:e.l}),p({h:(s+240)%360,s:e.s,l:e.l})]}function k(t){var e=p(t).toHsl(),s=e.h;return[p(t),p({h:(s+90)%360,s:e.s,l:e.l}),p({h:(s+180)%360,s:e.s,l:e.l}),p({h:(s+270)%360,s:e.s,l:e.l})]}function I(t){var e=p(t).toHsl(),s=e.h;return[p(t),p({h:(s+72)%360,s:e.s,l:e.l}),p({h:(s+216)%360,s:e.s,l:e.l})]}function E(t,e,s){e=e||6,s=s||30;var a=p(t).toHsl(),n=360/s,i=[p(t)];for(a.h=(a.h-(n*e>>1)+720)%360;--e;)a.h=(a.h+n)%360,i.push(p(a));return i}function z(t,e){e=e||6;for(var s=p(t).toHsv(),a=s.h,n=s.s,i=s.v,r=[],o=1/e;e--;)r.push(p({h:a,s:n,v:i})),i=(i+o)%1;return r}p.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,s,a=this.toRgb();return t=a.r/255,e=a.g/255,s=a.b/255,.2126*(t<=.03928?t/12.92:n.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:n.pow((e+.055)/1.055,2.4))+.0722*(s<=.03928?s/12.92:n.pow((s+.055)/1.055,2.4))},setAlpha:function(t){return this._a=R(t),this._roundA=c(100*this._a)/100,this},toHsv:function(){var t=v(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=v(this._r,this._g,this._b),e=c(360*t.h),s=c(100*t.s),a=c(100*t.v);return 1==this._a?"hsv("+e+", "+s+"%, "+a+"%)":"hsva("+e+", "+s+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var t=u(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=u(this._r,this._g,this._b),e=c(360*t.h),s=c(100*t.s),a=c(100*t.l);return 1==this._a?"hsl("+e+", "+s+"%, "+a+"%)":"hsla("+e+", "+s+"%, "+a+"%, "+this._roundA+")"},toHex:function(t){return f(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,s,a,n){var i=[T(c(t).toString(16)),T(c(e).toString(16)),T(c(s).toString(16)),T(q(a))];if(n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1))return i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0);return i.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:c(this._r),g:c(this._g),b:c(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+c(this._r)+", "+c(this._g)+", "+c(this._b)+")":"rgba("+c(this._r)+", "+c(this._g)+", "+c(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:c(100*$(this._r,255))+"%",g:c(100*$(this._g,255))+"%",b:c(100*$(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+c(100*$(this._r,255))+"%, "+c(100*$(this._g,255))+"%, "+c(100*$(this._b,255))+"%)":"rgba("+c(100*$(this._r,255))+"%, "+c(100*$(this._g,255))+"%, "+c(100*$(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(M[f(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+m(this._r,this._g,this._b,this._a),s=e,a=this._gradientType?"GradientType = 1, ":"";if(t){var n=p(t);s="#"+m(n._r,n._g,n._b,n._a)}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+e+",endColorstr="+s+")"},toString:function(t){var e=!!t;t=t||this._format;var s=!1,a=this._a<1&&this._a>=0;return e||!a||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(s=this.toRgbString()),"prgb"===t&&(s=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(s=this.toHexString()),"hex3"===t&&(s=this.toHexString(!0)),"hex4"===t&&(s=this.toHex8String(!0)),"hex8"===t&&(s=this.toHex8String()),"name"===t&&(s=this.toName()),"hsl"===t&&(s=this.toHslString()),"hsv"===t&&(s=this.toHsvString()),s||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return p(this.toString())},_applyModification:function(t,e){var s=t.apply(null,[this].concat([].slice.call(e)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function(){return this._applyModification(y,arguments)},brighten:function(){return this._applyModification(w,arguments)},darken:function(){return this._applyModification(x,arguments)},desaturate:function(){return this._applyModification(g,arguments)},saturate:function(){return this._applyModification(_,arguments)},greyscale:function(){return this._applyModification(b,arguments)},spin:function(){return this._applyModification(C,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(E,arguments)},complement:function(){return this._applyCombination(L,arguments)},monochromatic:function(){return this._applyCombination(z,arguments)},splitcomplement:function(){return this._applyCombination(I,arguments)},triad:function(){return this._applyCombination(S,arguments)},tetrad:function(){return this._applyCombination(k,arguments)}},p.fromRatio=function(t,e){if("object"==typeof t){var s={};for(var a in t)t.hasOwnProperty(a)&&(s[a]="a"===a?t[a]:D(t[a]));t=s}return p(t,e)},p.equals=function(t,e){return!(!t||!e)&&p(t).toRgbString()==p(e).toRgbString()},p.random=function(){return p.fromRatio({r:d(),g:d(),b:d()})},p.mix=function(t,e,s){s=0===s?0:s||50;var a=p(t).toRgb(),n=p(e).toRgb(),i=s/100;return p({r:(n.r-a.r)*i+a.r,g:(n.g-a.g)*i+a.g,b:(n.b-a.b)*i+a.b,a:(n.a-a.a)*i+a.a})},p.readability=function(t,e){var s=p(t),a=p(e);return(n.max(s.getLuminance(),a.getLuminance())+.05)/(n.min(s.getLuminance(),a.getLuminance())+.05)},p.isReadable=function(t,e,s){var a,n,i=p.readability(t,e);switch(n=!1,(a=function(t){var e,s;e=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase(),s=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA");"small"!==s&&"large"!==s&&(s="small");return{level:e,size:s}}(s)).level+a.size){case"AAsmall":case"AAAlarge":n=i>=4.5;break;case"AAlarge":n=i>=3;break;case"AAAsmall":n=i>=7}return n},p.mostReadable=function(t,e,s){var a,n,i,r,o=null,c=0;n=(s=s||{}).includeFallbackColors,i=s.level,r=s.size;for(var l=0;l<e.length;l++)(a=p.readability(t,e[l]))>c&&(c=a,o=p(e[l]));return p.isReadable(t,o,{level:i,size:r})||!n?o:(s.includeFallbackColors=!1,p.mostReadable(t,["#fff","#000"],s))};var A=p.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},M=p.hexNames=function(t){var e={};for(var s in t)t.hasOwnProperty(s)&&(e[t[s]]=s);return e}(A);function R(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function $(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var s=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=l(e,h(0,parseFloat(t))),s&&(t=parseInt(t*e,10)/100),n.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function F(t){return l(1,h(0,t))}function H(t){return parseInt(t,16)}function T(t){return 1==t.length?"0"+t:""+t}function D(t){return t<=1&&(t=100*t+"%"),t}function q(t){return n.round(255*parseFloat(t)).toString(16)}function N(t){return H(t)/255}var j,P,G,O=(P="[\\s|\\(]+("+(j="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+j+")[,|\\s]+("+j+")\\s*\\)?",G="[\\s|\\(]+("+j+")[,|\\s]+("+j+")[,|\\s]+("+j+")[,|\\s]+("+j+")\\s*\\)?",{CSS_UNIT:new RegExp(j),rgb:new RegExp("rgb"+P),rgba:new RegExp("rgba"+G),hsl:new RegExp("hsl"+P),hsla:new RegExp("hsla"+G),hsv:new RegExp("hsv"+P),hsva:new RegExp("hsva"+G),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function K(t){return!!O.CSS_UNIT.exec(t)}t.exports?t.exports=p:void 0===(a=function(){return p}.call(e,s,e,t))||(t.exports=a)}(Math)},function(t,e,s){"use strict";s.r(e);s(2);var a=(t,e,...s)=>{const a=document.createElement(t);return Object.entries(e).forEach(([t,e])=>{a.style[t]=e}),[...s].forEach(t=>{a.classList.add(t)}),a};class n{constructor(t){this.app=t,this.line=a("div",{},"_line"),this.selected=null}handling(t){"_item"===t.target.classList[0]&&(this.app.pensize=t.target.dataset.pensize,t.target.classList.contains("selected")||(this.selected.classList.remove("selected"),this.selected=t.target,t.target.classList.add("selected")))}start(){const t=document.createDocumentFragment(),e=document.createElement("div");e.className="_pen-size";const s=document.createElement("span");s.innerHTML="Pen size",[1,2,3,4].forEach(t=>{const e=a("div",{},"_item");e.innerHTML=`${t}x`,e.dataset.pensize=t,t==this.app.pensize&&(e.classList.add("selected"),this.selected=e),this.line.appendChild(e)}),e.appendChild(s),e.appendChild(this.line),t.appendChild(e),document.querySelector(".menu").appendChild(t),this.line.addEventListener("click",this.handling.bind(this))}}var i=(t,e,s)=>{const a=document.createElement(t);return s&&Object.entries(s).forEach(([t,e])=>{a.style[t]=e}),a.className=e,a},r=s(0);class o{constructor(t){this.controll=t,this.color=null,this.panel,this.show_pallete=i("button","color-pallete-button"),this.show_pallete.innerHTML="Choose Color",this.color_picker}mainFunc(){}start(){const t=this;t.controll.color_content.appendChild(this.show_pallete);const e=i("div","color-picker-panel"),s=i("div","panel-row"),a=i("div","swatches default-swatches"),n=i("button","button eyedropper");n.innerHTML="Get Color",s.appendChild(a),s.appendChild(n);const o=i("div","panel-row"),c=i("div","spectrum-map"),l=i("button","color-cursor");l.id="spectrum-cursor";const h=i("canvas","spectrum-canvas");h.id="spectrum-canvas",c.appendChild(l),c.appendChild(h);const d=i("div","hue-map"),p=i("button","color-cursor");p.id="hue-cursor";const u=i("canvas","hue-canvas");u.id="hue-canvas",d.appendChild(p),d.appendChild(u),o.appendChild(c),o.appendChild(d);const v=i("div","panel-row"),f=i("div","field-group value-fields rgb-fields active");f.id="rgb-fields";const m=i("div","field-group"),g=i("label","field-label");g.for="",g.innerHTML="R:";const _=i("input","field-input rgb-input");_.type="number",_.max="255",_.min="0",_.id="red",m.appendChild(g),m.appendChild(_);const b=i("div","field-group"),y=i("label","field-label");y.for="",y.innerHTML="G:";const w=i("input","field-input rgb-input");w.type="number",w.max="255",w.min="0",w.id="green",b.appendChild(y),b.appendChild(w);const x=i("div","field-group"),C=i("label","field-label");C.for="",C.innerHTML="B:";const L=i("input","field-input rgb-input");L.type="number",L.max="255",L.min="0",L.id="blue",x.appendChild(C),x.appendChild(L),f.appendChild(m),f.appendChild(b),f.appendChild(x);const S=i("div","field-group value-fields hex-field");S.id="hex-field";const k=i("label","field-label");k.for="",k.innerHTML="Hex:";const I=i("input","field-input");I.type="text",I.id="hex",S.appendChild(k),S.appendChild(I);const E=i("button","button mode-toggle");E.id="mode-toggle",E.innerHTML="Mode",v.appendChild(f),v.appendChild(S),v.appendChild(E);const z=i("div","panel-row"),A=i("h2","panel-header");A.innerHTML="User Colors";const M=i("div","swatches custom-swatches");M.id="user-swatches";const R=i("button","button add-swatch");R.id="add-swatch";const $=i("span","color-indicator");$.id="color-indicator";const F=i("span","");F.innerHTML="Add to Swatches",R.appendChild($),R.appendChild(F),z.appendChild(A),z.appendChild(M),z.appendChild(R),e.appendChild(s),e.appendChild(o),e.appendChild(v),e.appendChild(z),this.controll.color_content.appendChild(e),this.panel=e,this.panel.style.display="none";const H=h.getContext("2d");let T=h.getBoundingClientRect();const D=u.getContext("2d");let q=u.getBoundingClientRect(),N="",j=0,P=1,G=.5,O="";function K(){var t,e,s;this.addDefaultSwatches(),Y(),t=u,(s=(e=D).createLinearGradient(0,0,0,t.height)).addColorStop(0,"hsl(0,100%,50%)"),s.addColorStop(.17,"hsl(298.8, 100%, 50%)"),s.addColorStop(.33,"hsl(241.2, 100%, 50%)"),s.addColorStop(.5,"hsl(180, 100%, 50%)"),s.addColorStop(.67,"hsl(118.8, 100%, 50%)"),s.addColorStop(.83,"hsl(61.2,100%,50%)"),s.addColorStop(1,"hsl(360,100%,50%)"),e.fillStyle=s,e.fillRect(0,0,t.width,t.height),t.addEventListener("mousedown",(function(t){!function(t){st(t),p.classList.add("dragging"),window.addEventListener("mousemove",st),window.addEventListener("mouseup",nt)}(t)}))}function U(t,e){let s=document.createElement("button");s.classList.add("swatch"),s.setAttribute("title",e),s.style.backgroundColor=e,s.addEventListener("click",(function(){let t=r(this.style.backgroundColor);W(t),X(t)})),t.appendChild(s),B()}function B(){T=h.getBoundingClientRect(),q=u.getBoundingClientRect()}function Y(t){let e=h,s=H;s.clearRect(0,0,e.width,e.height),t||(t="#f00"),s.fillStyle=t,s.fillRect(0,0,e.width,e.height);var a=s.createLinearGradient(0,0,e.width,0);a.addColorStop(0,"#fff"),a.addColorStop(1,"transparent"),s.fillStyle=a,s.fillRect(0,0,e.width,e.height);var n=s.createLinearGradient(0,0,0,e.height);n.addColorStop(0,"transparent"),n.addColorStop(1,"#000"),s.fillStyle=n,s.fillRect(0,0,e.width,e.height),e.addEventListener("mousedown",(function(t){Z(t)}))}function W(t){var e=(t=r(t)).toHsl();j=e.h;var s=t.toHsv(),a=T.width*s.s,n=T.height*(1-s.v),i=q.height-j/360*q.height;Q(a,n),J(i),V(t),Y(function(t){return t=r(t),r("hsl "+t.toHsl().h+" 1 .5").toHslString()}(t))}function X(t){var e=(t=r(t)).toRgb(),s=t.toHex();_.value=e.r,w.value=e.g,L.value=e.b,I.value=s}function V(t){t=r(t),O=`#${t.toHex()}`,N=t,$.style.backgroundColor=t,document.querySelector("header").style.backgroundColor=t,l.style.backgroundColor=t,p.style.backgroundColor="hsl("+t.toHsl().h+", 100%, 50%)"}function J(t){p.style.top=t+"px"}function Q(t,e){l.style.left=t+"px",l.style.top=e+"px"}K.prototype.defaultSwatches=["#FFFFFF","#FFFB0D","#0532FF","#FF9300","#00F91A","#FF2700","#000000","#686868","#EE5464","#D27AEE","#5BA8C4","#E64AA9"],K.prototype.addDefaultSwatches=function(){for(let t=0;t<this.defaultSwatches.length;++t)U(a,this.defaultSwatches[t])};var Z=function(t){tt(t),l.classList.add("dragging"),window.addEventListener("mousemove",tt),window.addEventListener("mouseup",et)};function tt(t){t.preventDefault();var e=t.pageX-T.left,s=t.pageY-T.top;e>T.width&&(e=T.width),e<0&&(e=0),s>T.height&&(s=T.height),s<0&&(s=.1);var a=e/T.width*100,n=1-s/T.height*100/100,i=a/100;G=n/2*(2-i),P=n*i/(1-Math.abs(2*G-1));var o=r("hsl "+j+" "+P+" "+G);V(o),X(o),Q(e,s)}function et(t){l.classList.remove("dragging"),window.removeEventListener("mousemove",tt)}function st(t){t.preventDefault();var e=t.pageY-q.top;e>q.height&&(e=q.height),e<0&&(e=0);var s=e/q.height;j=360-360*s;var a=r("hsl "+j+" 1 .5").toHslString(),n=r("hsl "+j+" "+P+" "+G).toHslString();Y(a),J(e),V(n),X(n)}const at=()=>{t.panel.style.display="none",t.show_pallete.removeEventListener("click",at)};function nt(t){p.classList.remove("dragging"),window.removeEventListener("mousemove",st)}_.addEventListener("change",(function(){W(r("rgb "+_.value+" "+w.value+" "+L.value))})),w.addEventListener("change",(function(){W(r("rgb "+_.value+" "+w.value+" "+L.value))})),L.addEventListener("change",(function(){W(r("rgb "+_.value+" "+w.value+" "+L.value))})),R.addEventListener("click",(function(){U(M,N)})),E.addEventListener("click",(function(){f.classList.contains("active")?f.classList.remove("active"):f.classList.add("active"),S.classList.contains("active")?S.classList.remove("active"):S.classList.add("active")})),n.addEventListener("click",()=>{this.panel.style.display="none",t.controll.changeColor(O)}),t.show_pallete.addEventListener("click",()=>{t.panel.style.display="block",t.show_pallete.addEventListener("click",at),B()}),window.addEventListener("resize",(function(){B()})),this.color_picker=new K}}class c{constructor(t){this.app=t,this.color_content=document.createElement("div"),this.current_color=document.createElement("div"),this.previous_color=document.createElement("div"),this.pallete=document.createElement("div"),this.color_menu=document.createElement("div"),this.color_pallete=new o(this),this.header=document.querySelector("header")}changeColor(t){if(t!==this.app.current_color){const e=this.app.current_color;this.current_color.style.background=t,this.app.current_color=t,this.current_color.dataset.color=t,this.previous_color.style.background=e,this.app.previous_color=e,this.previous_color.dataset.color=e,this.header.style.background=t}}handle(t){const{target:e}=t;if("_item"===e.className){const{color:t}=e.dataset;this.changeColor(t)}}showPanel(){this.color_pallete.panel.style.display="block"}start(){const t=document.createDocumentFragment();this.color_content.className="_color_menu",this.color_menu.className="_colors",this.pallete.className="_pallete",this.pallete.style.display="none",this.current_color.className="_item",this.previous_color.className="_item";["#FF0000","#FFA500","#FFFF00","#008000","#0000FF","#00008B","#831383"].forEach(t=>{const e=document.createElement("div");e.className="_item",e.dataset.color=t,e.style.background=t,this.pallete.appendChild(e)}),this.current_color.style.background=this.app.current_color,this.current_color.dataset.color=this.app.current_color,this.previous_color.style.background=this.app.previous_color,this.previous_color.dataset.color=this.app.previous_color;const e=document.createElement("div"),s=document.createElement("div");e.className="_line",s.className="_line",e.appendChild(this.current_color),s.appendChild(this.previous_color);const a=document.createElement("span");a.innerHTML="Current Color";const n=document.createElement("span");n.innerHTML="Previous Color",e.appendChild(a),s.appendChild(n),this.color_menu.appendChild(e),this.color_menu.appendChild(s),this.color_content.appendChild(this.color_menu),this.color_content.appendChild(this.pallete),t.appendChild(this.color_content),document.querySelector(".menu").appendChild(t),this.color_content.addEventListener("click",this.handle.bind(this)),console.log(this.app.current_color),this.header.style.background=this.app.current_color,this.color_pallete.start()}}class l{constructor(t){this.app=t,this.API_KEY="2887c5cdabcfdda6eb369774636e205dc3fbb66527438b259580c3f60db977f9",this.canvas_center=this.app.app.canvas_center}handleInput(t){if(13===t.which){const{value:e}=t.target;this.getRandomImage(e)}}async getRandomImage(t){const e=`https://api.unsplash.com/photos/random?query=town,${t?t.split(" ").join(""):"Minsk"}&client_id=${this.API_KEY}`;await fetch(e).then(t=>t.json()).then(t=>this.canvas_center.load_image.call(this.canvas_center,t.urls.small)).catch(()=>this.canvas_center.load_image.call(this.canvas_center,"../src/js/DataLoad/data/testImage.png"))}start(){this.app.input.addEventListener("keyup",this.handleInput.bind(this))}}class h{constructor(t){this.app=t,this.input=document.createElement("input"),this.grayscale=document.createElement("div"),this.clear_canvas=document.createElement("div"),this.data_loader=new l(this)}start(){const t=document.createDocumentFragment(),e=document.createElement("div");e.className="_data_menu";const s=document.createElement("div");s.className="menu_button",s.dataset.value="image";const a=document.createElement("div");a.className="_data_menu_town";const n=document.createElement("h4");n.innerHTML="Load random image";const i=document.createElement("label");i.className="_label",i.innerHTML="Choose Town",a.appendChild(n),a.appendChild(i),a.appendChild(this.input),this.grayscale.className="_grayscale",this.grayscale.innerHTML="To grayscale",this.clear_canvas.className="_clearcanvas",this.clear_canvas.innerHTML="Clear canvas",e.appendChild(a),e.appendChild(this.grayscale),e.appendChild(this.clear_canvas),t.appendChild(e),document.querySelector("main").appendChild(t),this.data_loader.start(),this.grayscale.addEventListener("click",this.app.canvas_center.grayscale),this.clear_canvas.addEventListener("click",()=>this.app.canvas_center.clear_canvas())}}class d{constructor(t,e){this.app=t,this.content=document.createElement("div"),this.instruments=["pencil","fill_bucket","all_pixel_bucket","color_picker","mirror","eraser","stroke","rectangle","circle","dithering","lighten","move"],this.instruments.includes(e.instrument)?this.selected=e.instrument:(this.selected="pencil",this.app.instrument="pencil"),this.setInstrument=this.setInstrument.bind(this),this.keyPress=this.keyPress.bind(this)}changeCursor(){const{instrument:t}=this.app,e=this.app.frames.canvas.content;"pencil"===t?e.style.cursor="url('../src/assets/cursors/pencil.cur'), pointer":"fill_bucket"===t?e.style.cursor="url('../src/assets/cursors/bucket.cur'), pointer":"color_picker"===t?e.style.cursor="url('../src/assets/cursors/color-picker.cur'), pointer":"eraser"===t?e.style.cursor="url('../src/assets/cursors/eraser.cur'), url(http://www.rw-designer.com/cursor-extern.php?id=72976), pointer":"stroke"===t?e.style.cursor="url('../src/assets/cursors/stroke.cur'), url(http://www.rw-designer.com/cursor-extern.php?id=79402), pointer":"circle"===t?e.style.cursor="url('../src/assets/cursors/circle.cur'), auto":"rectangle"===t?e.style.cursor="url('../src/assets/cursors/rect.cur'), url(http://cur.cursors-4u.net/cursors/cur-1/cur5.cur), auto":"mirror"===t?e.style.cursor="url('../src/assets/cursors/mirror.cur'), url(http://cur.cursors-4u.net/holidays/hol-5/hol449.cur), auto":"dithering"===t?e.style.cursor="url('../src/assets/cursors/dithering.cur'), url(http://cur.cursors-4u.net/sports/spo-7/spo724.cur), auto":"all_pixel_bucket"===t?e.style.cursor="url('../src/assets/cursors/bucket.cur'), pointer":"lighten"===t?e.style.cursor="url('../src/assets/cursors/lighten.cur'), url(http://cur.cursors-4u.net/nature/nat-11/nat1009.cur), auto":"move"===t&&(e.style.cursor="grab")}handler(t){this.selected||(this.selected="eraser");const{target:e}=t;e.dataset.instrument!==this.app.instrument&&(this.selected.classList.remove("selected"),e.classList.add("selected"),this.selected=e,this.app.instrument=e.dataset.instrument,this.changeCursor())}setInstrument(t){this.app.instrument=t,this.changeCursor(),this.selected.classList.remove("selected"),this.selected=document.querySelector(`._item[data-instrument=${t}]`),this.selected.classList.add("selected")}keyPress(t){112===t.keyCode?this.setInstrument("pencil"):98===t.keyCode?this.setInstrument("fill_bucket"):97===t.keyCode?this.setInstrument("all_pixel_bucket"):111===t.keyCode?this.setInstrument("color_picker"):118===t.keyCode?this.setInstrument("mirror"):101===t.keyCode?this.setInstrument("eraser"):108===t.keyCode?this.setInstrument("stroke"):114===t.keyCode?this.setInstrument("rectangle"):99===t.keyCode?this.setInstrument("circle"):116===t.keyCode?this.setInstrument("dithering"):117===t.keyCode&&this.setInstrument("lighten")}start(){const t=["    \n            <div>Pen tool <span class='tooltip-shortcut'>(P)</span></div>\n        ","\n                <div>Paint bucket tool <span class='tooltip-shortcut'>(B)</span></div>\n        ","\n            <div>Paint all pixels of the same color <span class='tooltip-shortcut'>(A)</span></div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>CTRL</span>\n                Apply to all layers\n            </div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>SHIFT</span>\n                Apply to all frames\n            </div>\n        ","\n            <div>Color picker <span class='tooltip-shortcut'>(O)</span></div>\n        ","\n            <div>Vertical Mirror pen <span class='tooltip-shortcut'>(V)</span></div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>CTRL</span>\n                Use horizontal axis\n            </div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>SHIFT</span>\n                Use horizontal and vertical axis\n            </div>\n        ","\n            <div>Eraser tool <span class='tooltip-shortcut'>(E)</span></div>\n        ","\n            <div>Stroke tool <span class='tooltip-shortcut'>(L)</span></div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>SHIFT</span>\n                Hold shift to draw straight lines\n            </div>\n        ","\n            <div>Rectangle tool <span class='tooltip-shortcut'>(R)</span></div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>SHIFT</span>\n                Keep 1 to 1 ratio\n            </div>\n        ","\n            <div>Circle tool <span class='tooltip-shortcut'>(C)</span></div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>SHIFT</span>\n                Keep 1 to 1 ratio\n            </div>\n        ","\n            <div>Dithering tool <span class='tooltip-shortcut'>(T)</span></div>\n        ","\n            <div>Lighten <span class='tooltip-shortcut'>(U)</span></div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>CTRL</span>\n                Darken\n            </div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>SHIFT</span>\n                Apply only once per pixel\n            </div>\n        ","\n        <div>Move tool <span class='tooltip-shortcut'>(M)</span></div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>CTRL</span>\n                Apply to all layers\n            </div>\n        <div class='tooltip-descriptor'>\n            <span class='tooltip-descriptor-button'>SHIFT</span>\n            Apply to all frames\n        </div>\n        <div class='tooltip-descriptor'>\n            <span class='tooltip-descriptor-button'>ALT</span>\n            Wrap canvas borders\n        </div>\n        "];this.content.className="instrument-panel",this.instruments.forEach((e,s)=>{const a=document.createElement("div");a.className="_item",e===this.app.instrument&&(a.classList.add("selected"),this.selected=a),a.dataset.instrument=e,a.dataset.original_title=t[s],a.addEventListener("mouseenter",()=>{const t=i("div","tooltip-container"),e=a.offsetLeft,s=a.offsetTop;t.innerHTML=a.dataset.original_title,t.style.left=`${e+50}px`,t.style.top=`${s+50}px`,this.content.appendChild(t),a.addEventListener("mouseleave",()=>{t.remove()})}),this.content.appendChild(a)}),this.changeCursor(),document.querySelector(".menu").appendChild(this.content),this.content.addEventListener("click",this.handler.bind(this)),document.querySelector("body").style.cursor="auto",window.addEventListener("keypress",this.keyPress),window.onunload=()=>{localStorage.setItem("instrument",this.selected)}}}class p{constructor(t,e){this.body=a("div",{width:"96px",height:"96px"},"__item"),this.canvas=a("canvas",{width:"96px",height:"96px"},"__canvas"),this.canvas.width=32,this.canvas.height=32,this.number=a("div",{},"__number"),this.copy=a("div",{},"__copy"),this.delete=a("div",{},"__delete"),this.move=a("div",{},"__move"),this.body.appendChild(this.canvas),this.body.appendChild(this.number),this.body.appendChild(this.copy),this.body.appendChild(this.delete),this.body.appendChild(this.move),this.ctx=this.canvas.getContext("2d"),this.frames_field=t,this.app=this.frames_field.app,this.id=e,this.render=this.render.bind(this),this.main_canvas=this.frames_field.canvas,this.get_image_data=this.get_image_data.bind(this)}render(t,e){this.body.dataset.position=t,this.body.style.position="relative",this.body.style.top="0",this.id=t,this.number.innerHTML=t,e.appendChild(this.body),this.frames_field.frames.length<=1?(this.delete.style.visibility="0",this.move.style.top="24px"):(this.delete.style.visibility="1",this.move.style.top="0")}add_selection(){this.body.classList.add("selected")}remove_selection(){this.body.classList.remove("selected")}put_image_data(t){const e=new Image(this.canvas.width,this.canvas.width);e.src=t,e.onload=()=>{this.ctx.clearRect(0,0,32,32),this.ctx.drawImage(e,0,0)}}get_image_data(){return this.canvas.toDataURL("image/png")}}class u{constructor(t){this.app=t}drawSquare(t){this.app.ctx.fillRect(t[0],t[1],t[2],t[2])}draw(t){const e=t=>{this.app.ctx.fillRect(t[0],t[1],t[2],t[2])},s=(t,s)=>{const a=this.app.getSquare(t);a!==s&&(e(a),this.app.reload_frame())},a=()=>{this.app.shadow_canvas.style.zIndex="5",this.app.canvas.removeEventListener("mousemove",s),this.app.canvas.removeEventListener("mouseup",a),this.app.canvas.removeEventListener("mouseleave",a)};e(t),this.app.canvas.addEventListener("mousemove",s,!1),this.app.canvas.addEventListener("mouseup",a),this.app.canvas.addEventListener("mouseleave",a)}}class v{constructor(t){this.app=t}draw(t){this.app.shadow_canvas.style.zIndex="0";const e=t=>{const{data:e}=this.app.ctx.getImageData(t[0],t[1],1,1);return(t=>{const e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?`#${`0${parseInt(e[1],10).toString(16)}`.slice(-2)}${`0${parseInt(e[2],10).toString(16)}`.slice(-2)}${`0${parseInt(e[3],10).toString(16)}`.slice(-2)}`:""})(`rgba(${e[0]},${e[1]},${e[2]},${e[3]}`)},s=e(t),a=this.app.canvas.width,n=t=>{const a=t[1]-1;if(a<0)return!1;const n=[t[0],a,1];return s===e(n)},i=t=>{const n=t[1]+1;if(n>a-t[2])return!1;const i=[t[0],n,1];return s===e(i)};if(s.toUpperCase()===this.app.app.current_color)return null;let r,o,c;const l=[],h=[],d=t=>{if((t=>{const a=t[0]-1;if(a<0)return!1;const n=[a,t[1],1];return s===e(n)})(t)){const e=t[0]-1,s=t[1],a=1;l.push([e,s,a])}if((t=>{const n=t[0]+1;if(n>a-1)return;const i=[n,t[1],1];return s===e(i)})(t)){const e=t[0]+1,s=t[1],a=1;h.push([e,s,a])}},p=t=>{for(r=t[0],o=t[1],c=1;n([r,o,1]);)o-=1;for(this.app.ctx.fillRect(r,o,1,1);i([r,o,1]);)this.app.ctx.fillRect(r,o,1,1),d([r,o,1]),o+=1;d([r,o,1]),this.app.ctx.fillRect(r,o,1,1)};for(p(t);h.length>0;)p(h.pop());for(;l.length>0;)p(l.pop());this.app.reload_frame()}}class f{constructor(t){this.app=t}pick_color(t){const e=(t=>{const{data:e}=this.app.ctx.getImageData(t[0]+2,t[1]+2,1,1);return(t=>{const e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?`#${`0${parseInt(e[1],10).toString(16)}`.slice(-2)}${`0${parseInt(e[2],10).toString(16)}`.slice(-2)}${`0${parseInt(e[3],10).toString(16)}`.slice(-2)}`:""})(`rgba(${e[0]},${e[1]},${e[2]},${e[3]}`)})(t);this.app.app.color_controll.changeColor(e)}}class m{constructor(t){this.app=t}clear(t){const e=t=>{this.app.ctx.clearRect(t[0],t[1],t[2],t[2])},s=(t,s)=>{const a=this.app.getSquare(t);a!==s&&(e(a),this.app.reload_frame())},a=()=>{this.app.shadow_canvas.style.zIndex="5",this.app.canvas.removeEventListener("mousemove",s),this.app.canvas.removeEventListener("mouseup",a),this.app.canvas.removeEventListener("mouseleave",a)};e(t),this.app.canvas.addEventListener("mousemove",s),this.app.canvas.addEventListener("mouseup",a),this.app.canvas.addEventListener("mouseleave",a)}}class g{constructor(t){this.app=t}draw(t){this.app.path_canvas.style.zIndex="6";const e=t;let s=e;const a=this.app.path_ctx,n=(t,e,s,a)=>{t.fillRect(e,s,a,a)},i=(t,e,i)=>{const r=i||a;s=e;const o=e[0],c=t[0],l=e[1],h=t[1],d=parseInt(t[2]),p=o-c,u=l-h,v=p>0?1:-1,f=u>0?1:-1;let m;m=0===p||0===u?0:Math.abs(u/p);let g=c,_=h;n(r,[g,_,d]);for(let t=0;t<Math.abs(p);t+=1)g+=v,_+=m*f,n(r,g,Math.round(_),d);g=c,_=h,0!==m&&(m=1/m);for(let t=0;t<Math.abs(u);t+=1)g+=v*m,_+=f,n(r,Math.round(g),_,d)},r=t=>{const a=this.app.getSquare(t);a[0]===s[0]&&a[1]===s[1]||(s=a,this.app.path_ctx.clearRect(0,0,32,32),i(e,a,this.app.path_ctx))};n(this.app.path_ctx,e);const o=()=>{this.app.shadow_canvas.style.zIndex="5",this.app.path_canvas.style.zIndex="0",this.app.canvas.removeEventListener("mousemove",r),this.app.path_canvas.removeEventListener("mouseup",o),this.app.path_canvas.removeEventListener("mouseleave",o),this.app.path_ctx.clearRect(0,0,32,32),i(e,s,this.app.ctx),this.app.reload_frame()};this.app.path_canvas.addEventListener("mousemove",r),this.app.path_canvas.addEventListener("mouseup",o),this.app.path_canvas.addEventListener("mouseleave",o)}}class _{constructor(t){this.canvas=t}draw(t){this.canvas.path_canvas.style.zIndex="6";const e=t,s=this.canvas.path_ctx,a=e[0],n=e[1],i=parseInt(t[2]);let r=!1;const o=(t,e,s,a)=>{t.fillRect(e,s,a,a)},c=(t,e)=>{const c=e||s;let l,h;r?(l=Math.abs(t[0])>=Math.abs(t[1])?t[1]:t[0],h=l):(l=t[0],h=t[1]);const d=Math.abs((l-a)/2),p=Math.abs((h-n)/2),u=a+d*(l>a?1:-1),v=n+p*(h>n?1:-1);let f=u,m=v;for(let t=0;t<360;t+=1)f=Math.round(u+d*Math.cos(1/Math.tan(d/p*Math.tan(t)))),m=Math.round(v+p*Math.sin(1/Math.tan(d/p*Math.tan(t)))),o(c,f,m,i)},l=t=>{t.shiftKey&&(r=!0);const s=this.canvas.getSquare(t);s[0]===e[0]&&s[1]===e[1]||(this.canvas.path_ctx.clearRect(0,0,32,32),c(s,this.canvas.path_ctx))},h=t=>{this.canvas.shadow_canvas.style.zIndex="5",this.canvas.path_canvas.style.zIndex="0",this.canvas.path_canvas.removeEventListener("mousemove",l),this.canvas.path_canvas.removeEventListener("mouseup",h),this.canvas.path_canvas.removeEventListener("mouseleave",h),this.canvas.path_ctx.clearRect(0,0,32,32),c(this.canvas.getSquare(t),this.canvas.ctx),this.canvas.reload_frame()};this.canvas.path_canvas.addEventListener("mousemove",l),this.canvas.path_canvas.addEventListener("mouseup",h),this.canvas.path_canvas.addEventListener("mouseleave",h)}}function b(t,e,s,a){const n=Math.floor(e/a)*a,i=Math.floor(s/a)*a;t.fillRect(n,i,a,a)}class y{constructor(t){this.canvas=t}draw(t){this.canvas.path_canvas.style.zIndex="6";const e=t,s=this.canvas.path_ctx,a=e[0],n=e[1],i=parseInt(t[2]);let r=!1;const o=(t,e)=>{const o=e||s;let c,l;r?(c=Math.abs(t[0])>=Math.abs(t[1])?t[1]:t[0],l=c):(c=t[0],l=t[1]);const h=Math.floor(c-a)/i,d=Math.floor(l-n)/i;let p=a,u=n;const v=h>0?1:-1,f=d>0?1:-1;console.log(`startX = ${a}; startY = ${n}`),console.log(`deltaX = ${h}; deltaY = ${d}`);for(let t=0;t<=Math.abs(h);t+=1)b(o,p,n,i),b(o,p,l,i),p+=v*i;for(let t=0;t<=Math.abs(d);t+=1)b(o,a,u,i),b(o,c,u,i),u+=f*i},c=t=>{t.shiftKey&&(r=!0);const s=this.canvas.getSquare(t);s[0]===e[0]&&s[1]===e[1]||(this.canvas.path_ctx.clearRect(0,0,32,32),o(s,this.canvas.path_ctx))},l=t=>{this.canvas.shadow_canvas.style.zIndex="5",this.canvas.path_canvas.style.zIndex="0",this.canvas.path_canvas.removeEventListener("mousemove",c),this.canvas.path_canvas.removeEventListener("mouseup",l),this.canvas.path_canvas.removeEventListener("mouseleave",l),this.canvas.path_ctx.clearRect(0,0,32,32),o(this.canvas.getSquare(t),this.canvas.ctx),this.canvas.reload_frame()};this.canvas.path_canvas.addEventListener("mousemove",c),this.canvas.path_canvas.addEventListener("mouseup",l),this.canvas.path_canvas.addEventListener("mouseleave",l)}}class w{constructor(t){this.canvas=t,this.draw=this.draw.bind(this)}draw(t,e){const s=t[0],a=t[1],n=t[2];console.log(e.shiftKey);const i=this.canvas.canvas.width,r=(t,e,s)=>{this.canvas.ctx.fillRect(t,e,s,s)};r(s,a,n),e.ctrlKey?r(s,i-1-a,n):e.shiftKey?(r(s,i-1-a,n),r(i-1-s,a,n),r(i-1-s,i-1-a,n)):r(i-1-s,a,n);const o=(t,o)=>{const c=this.canvas.getSquare(t),l=c[0],h=c[1];if(l!==s||h!==a){const t=i-1-l,s=i-1-h;r(l,h,n),e.ctrlKey?r(l,s,n):e.shiftKey?(r(l,s,n),r(t,h,n),r(t,s,n)):r(t,h,n),this.canvas.reload_frame()}},c=()=>{this.canvas.shadow_canvas.style.zIndex="5",this.canvas.canvas.removeEventListener("mousemove",o),this.canvas.canvas.removeEventListener("mouseup",c),this.canvas.canvas.removeEventListener("mouseleave",c)};r(t),this.canvas.canvas.addEventListener("mousemove",o,!1),this.canvas.canvas.addEventListener("mouseup",c),this.canvas.canvas.addEventListener("mouseleave",c)}}class x{constructor(t){this.canvas=t}draw(t){const e=t[0],s=t[1],a=t[2],n=this.canvas.ctx,i=(t,e)=>{t%2==0&&e%2==0?n.clearRect(t,e,1,1):t%2==1&&e%2==1?n.clearRect(t,e,1,1):n.fillRect(t,e,1,1)},r=(t,e)=>{for(let s=0;s<a;s++)for(let n=0;n<a;n++)i(t+s,e+n)},o=t=>{const a=this.canvas.getSquare(t),n=a[0],i=a[1];n===e&&i===s||(r(n,i),this.canvas.reload_frame())};r(e,s);const c=()=>{this.canvas.shadow_canvas.style.zIndex="5",this.canvas.canvas.removeEventListener("mousemove",o),this.canvas.canvas.removeEventListener("mouseup",c)};r(t),this.canvas.canvas.addEventListener("mousemove",o,!1),this.canvas.canvas.addEventListener("mouseup",c)}}class C{constructor(t){this.canvas=t}draw(t){const e=t=>{const{data:e}=this.canvas.ctx.getImageData(t[0],t[1],1,1);return(t=>{const e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?`#${`0${parseInt(e[1],10).toString(16)}`.slice(-2)}${`0${parseInt(e[2],10).toString(16)}`.slice(-2)}${`0${parseInt(e[3],10).toString(16)}`.slice(-2)}`:""})(`rgba(${e[0]},${e[1]},${e[2]},${e[3]}`)},s=this.canvas.canvas.width,a=e([t[0],t[1],1]);for(let t=0;t<s;t+=1)for(let n=0;n<s;n+=1){e([0+t,0+n,1])===a&&this.canvas.ctx.fillRect(0+t,0+n,1,1)}}}class L{constructor(t){this.canvas=t}draw(t,e){const s=t=>{const e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?`#${`0${parseInt(e[1],10).toString(16)}`.slice(-2)}${`0${parseInt(e[2],10).toString(16)}`.slice(-2)}${`0${parseInt(e[3],10).toString(16)}`.slice(-2)}`:""},a=t=>{const e=t[0],a=t[1],n=t[2],i=Math.floor(e+.2*(255-e)),r=Math.floor(a+.2*(255-a)),o=Math.floor(n+.2*(255-n));return s(`rgba(${i}, ${r}, ${o}, ${t[3]})`)},n=t=>{const e=t[0],a=t[1],n=t[2],i=Math.floor(.8*e),r=Math.floor(.8*a),o=Math.floor(.8*n);return s(`rgba(${i}, ${r}, ${o}, ${t[3]})`)},i=(t,e)=>{const{data:s}=this.canvas.ctx.getImageData(t,e,1,1);return[s[0],s[1],s[2],s[3]]},r=t[0],o=t[1],c=t[2];for(let t=0;t<c;t+=1)for(let s=0;s<c;s+=1){const c=i(r,o);let l;l=e.ctrlKey?n(c):a(c),this.canvas.ctx.fillStyle=l,this.canvas.ctx.fillRect(r+t,o+s,1,1),this.canvas.ctx.fillStyle=this.canvas.app.current_color,this.canvas.reload_frame()}}}class S{constructor(t){this.canvas=t}move(t,e){let s=this.canvas.app.pensize;const a=t[0],n=t[1];console.log(this.canvas.canvas.width);const i=this.canvas.ctx.getImageData(0,0,this.canvas.canvas.width,this.canvas.canvas.width);let r=a,o=n;const c=t=>{this.canvas.app.pensize=1;const e=this.canvas.getSquare(t),s=e[0],c=e[1],l=s-a,h=c-n,d=()=>{this.canvas.ctx.clearRect(0,0,this.canvas.app.canvas_size,this.canvas.app.canvas_size),this.canvas.ctx.putImageData(i,l,h)},p=()=>{const t=this.canvas.ctx,e=this.canvas.canvas.width;if(s!==r){let a,n;r>s?(a=t.getImageData(0,0,1,e),n=t.getImageData(1,0,e-1,e),t.clearRect(0,0,e,e),t.putImageData(a,e-1,0),t.putImageData(n,0,0)):(a=t.getImageData(e-1,0,1,e),n=t.getImageData(0,0,e-1,e),t.clearRect(0,0,e,e),t.putImageData(a,0,0),t.putImageData(n,1,0)),r=s}if(c!==o){let s,a;o>c?(s=t.getImageData(0,0,e,1),a=t.getImageData(0,1,e,e-1),t.clearRect(0,0,e,e),t.putImageData(s,0,e-1),t.putImageData(a,0,0)):(s=t.getImageData(0,e-1,e,1),a=t.getImageData(0,0,e,e-1),t.clearRect(0,0,e,e),t.putImageData(s,0,0),t.putImageData(a,0,1)),o=c}};t.altKey?p():d(),this.canvas.reload_frame()},l=()=>{this.canvas.shadow_canvas.style.zIndex="5",this.canvas.canvas.removeEventListener("mousemove",c),this.canvas.canvas.removeEventListener("mouseup",l),this.canvas.canvas.removeEventListener("mouseleave",l),this.canvas.app.pensize=s};this.canvas.canvas.addEventListener("mousemove",c,!1),this.canvas.canvas.addEventListener("mouseup",l),this.canvas.canvas.addEventListener("mouseleave",l)}}class k{constructor(t){this.canvas=t,this.content=i("div","transform",{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"20px",border:"1px solid white",justifyContent:"center"}),this.content.appendChild(i("span","_title",{fontSize:"1rem"})),this.panel=i("div","_conteiner",{display:"flex",flexDirection:"row"}),this.current_element=null}work(t){if(this.current_element=t.target.dataset.instrument,this.current_element,"counter-clockwise-rotation"===this.current_element){const t=this.canvas.canvas.width;this.canvas.ctx.getImageData(0,0,t,t);this.canvas.ctx.rotate(-90*Math.PI/180),this.canvas.ctx.translate(0,t)}console.log(this.current_element)}start(){const t=this.canvas.frames.player.content;this.content.innerHTML="Transform",this.content.appendChild(this.panel),t.appendChild(this.content);const e=["\n              <div>Flip vertically <span class='tooltip-shortcut'></span></div>\n              \n            <div class='tooltip-descriptor'>\n              <span class='tooltip-descriptor-button'>ALT</span>\n              Flip horizontally\n            </div>\n          \n            <div class='tooltip-descriptor'>\n              <span class='tooltip-descriptor-button'>CTRL</span>\n              Apply to all layers\n            </div>\n          \n            <div class='tooltip-descriptor'>\n              <span class='tooltip-descriptor-button'>SHIFT</span>\n              Apply to all frames\n            </div>\n          ","\n            <div>Counter-clockwise rotation <span class='tooltip-shortcut'></span></div>\n                <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>ALT</span>\n                Clockwise rotation\n            </div>\n\n            <div class='tooltip-descriptor'>\n            <span class='tooltip-descriptor-button'>CTRL</span>\n            Apply to all layers\n            </div>\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>SHIFT</span>\n                Apply to all frames\n            </div>\n        ","\n            <div>Clone current layer to all frames <span class='tooltip-shortcut'></span></div>\n        ","\n            <div>Align image to the center <span class='tooltip-shortcut'></span></div>\n                <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>CTRL</span>\n                Apply to all layers\n            </div>\n\n            <div class='tooltip-descriptor'>\n                <span class='tooltip-descriptor-button'>SHIFT</span>\n                Apply to all frames\n            </div>\n        "];["flip-verticaly","counter-clockwise-rotation","clone","align"].forEach((t,s)=>{const a=i("button","_item",{width:"40px",height:"40px"});a.dataset.instrument=t,this.panel.appendChild(a),a.addEventListener("click",this.work.bind(this));const n=i("div","tooltip-container",{position:"absolute",display:"none",width:"200px"}),r=a.offsetLeft,o=a.offsetTop;n.innerHTML=e[s],n.style.left=`${r-50}px`,n.style.top=`${o+50}px`,this.panel.appendChild(n),a.addEventListener("mouseenter",()=>{n.style.display="block"}),a.addEventListener("mouseleave",()=>{n.style.display="none"})})}}class I{constructor(t){this.frames=t,this.app=t.app,this.content=a("div",{overflow:"hidden"},"canvas-container"),this.canvas=a("canvas",{width:`${this.app.canvas_size}px`,height:`${this.app.canvas_size}px`,overflow:"hidden"},"canvas_main"),this.shadow_canvas=a("canvas",{opacity:"0.6",width:`${this.app.canvas_size}px`,height:`${this.app.canvas_size}px`,overflow:"hidden"},"shadow-canvas"),this.path_canvas=a("canvas",{position:"absolute",width:`${this.app.canvas_size}px`,height:`${this.app.canvas_size}px`,overflow:"hidden"},"path-canvas"),this.background=a("div",{position:"absolute",width:`${this.app.canvas_size}px`,height:`${this.app.canvas_size}px`,overflow:"hidden"},"backround"),this.path_canvas.height=32,this.path_canvas.width=32,this.ctx=this.canvas.getContext("2d"),this.path_ctx=this.path_canvas.getContext("2d"),this.pencil=new u(this),this.bucket=new v(this),this.color_picker=new f(this),this.eraser=new m(this),this.stroke=new g(this),this.circle=new _(this),this.rectangle=new y(this),this.mirror=new w(this),this.dithering=new x(this),this.all_pixel_bucket=new C(this),this.ligten=new L(this),this.move=new S(this),this.transform=new k(this),this.grayscale=this.grayscale.bind(this),this.reload_frame=this.reload_frame.bind(this),this.frame=null,document.querySelector("main").appendChild(this.content)}update_canvas_size(){this.change_by_size()}getSquare(t,e){const s=this.app.canvas_size/this.canvas.width,a=Math.floor((t.pageX-this.canvas.offsetLeft-this.content.offsetLeft)/s),n=Math.floor((t.pageY-this.canvas.offsetTop-this.content.offsetTop)/s),i=e||parseInt(this.app.pensize);return[i*Math.floor(a/i),i*Math.floor(n/i),i]}grayscale(){null!==this.app.image_data&&this.changeImageToGrayscale()}changeImageToGrayscale(){const t=(t=>{const{data:e}=t;for(let t=0;t<e.length;t+=4){const s=.34*e[t]+.5*e[t+1]+.16*e[t+2];e[t]=s,e[t+1]=s,e[t+2]=s}return t})(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.width));this.ctx.putImageData(t,0,0)}draw(t){t.preventDefault(),this.shadow_canvas.style.zIndex="0",1===t.which?this.ctx.fillStyle=this.app.current_color:3===t.which&&(this.ctx.fillStyle=this.app.previous_color);const e=this.getSquare(t);let s;"pencil"===this.app.instrument&&(s=this.pencil,this.pencil.draw(e)),"fill_bucket"===this.app.instrument&&this.bucket.draw(e),"color_picker"===this.app.instrument&&this.color_picker.pick_color(e),"mirror"===this.app.instrument&&this.mirror.draw(e,t),"eraser"===this.app.instrument&&this.eraser.clear(e),"stroke"===this.app.instrument&&(this.path_ctx.fillStyle=this.app.current_color,this.stroke.draw(e)),"circle"===this.app.instrument&&(this.path_ctx.fillStyle=this.app.current_color,this.circle.draw(e)),"rectangle"===this.app.instrument&&(this.path_ctx.fillStyle=this.app.current_color,this.rectangle.draw(e)),"dithering"===this.app.instrument&&this.dithering.draw(e),"all_pixel_bucket"===this.app.instrument&&this.all_pixel_bucket.draw(e),"lighten"===this.app.instrument&&this.ligten.draw(e,t),"move"===this.app.instrument&&(this.app.pensize=1,this.move.move(e,t))}clear_canvas(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.width),this.ctx.fillStyle=this.app.current_color}reload_frame(){const t=this.canvas.toDataURL("image/png");this.frame.put_image_data(t)}reload_canvas(t){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.width);const e=new Image(this.canvas.width,this.canvas.width);e.src=t,e.onload=()=>{this.ctx.drawImage(e,0,0)}}getImageData(){return this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}load_image(t){this.clear_canvas();const e=new Image;let s,a;e.src=t||"../src/js/DataLoad/data/image.png",e.setAttribute("crossorigin","anonymous"),e.onload=()=>{const t=this.canvas.width;if(parseInt(e.width)>=parseInt(e.height)){const n=e.height/e.width;s=t,a=Math.floor(s*n)}else{const n=e.width/e.height;a=t,s=Math.floor(a*n)}const n=(t-s)/2>0?(t-s)/2:0,i=(t-a)/2>0?(t-a)/2:0;this.ctx.drawImage(e,n,i,s,a),this.app.image_data=this.getImageData()}}change_by_size(){const t=new Image(this.app.canvas_size,this.app.canvas_size);t.src=this.canvas.toDataURL("image/png"),this.canvas.width=this.app.canvas_size,this.canvas.height=this.app.canvas_size,t.setAttribute("crossorigin","anonymous"),t.onload=()=>{this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(t,0,0,this.canvas.width,this.canvas.width)}}shadow_handling(t){const e=this.shadow_canvas.getContext("2d");let s;this.shadow_canvas.style.zIndex="5",e.fillStyle="grey",s="all_pixel_bucket"===this.app.instrument?1:this.app.pensize;let a=this.getSquare(t,s);console.log(a);const n=t=>{e.fillRect(t[0],t[1],t[2],t[2])};n(a);this.content.addEventListener("mousemove",(t=>{let s;s="all_pixel_bucket"===this.app.instrument?1:this.app.pensize;const i=this.getSquare(t,s);(t=>a[1]===t[1]&&a[0]===t[0])(i)||(e.clearRect(a[0],a[1],a[2],a[2]),n(i),a=i)}).bind(this))}resize(){[this.canvas,this.path_canvas,this.background,this.shadow_canvas].forEach(t=>{const e=this.content.offsetWidth,s=this.content.offsetHeight,a=(e-this.app.canvas_size)/2,n=(s-this.app.canvas_size)/2;t.style.left=`${a}px`,t.style.top=`${n}px`,t.style.width=`${this.app.canvas_size}px`,t.style.height=`${this.app.canvas_size}px`})}mWheel(t){const e=t.deltaY/100*32;t.preventDefault();const s=this.app.canvas_size+e;this.app.canvas_size=s>864||s<64?this.app.canvas_size:s,this.resize()}start(){this.canvas.width=32,this.canvas.height=32,this.shadow_canvas.width=32,this.shadow_canvas.height=32,this.content.appendChild(this.canvas),this.content.appendChild(this.path_canvas),this.content.appendChild(this.shadow_canvas),this.content.appendChild(this.background),this.ctx.imageSmoothingEnabled=!1,this.content.oncontextmenu=()=>!1,this.resize(),this.content.addEventListener("mousedown",this.draw.bind(this)),this.content.addEventListener("mouseenter",this.shadow_handling.bind(this)),window.addEventListener("resize",this.resize.bind(this)),this.content.addEventListener("wheel",this.mWheel.bind(this))}remove_canvas(){this.content.removeChild(this.canvas)}}class E{constructor(t){this.player=t,this.createGif=this.createGif.bind(this)}createGif(){const t=this.player.canvas_size,e=a("image",{height:`${t}px`,width:`${t}px`},"__gif");var s=new GIF({workers:2,quality:10,workerScript:"../node_modules/gif.js.optimized/dist/gif.worker.js"});this.player.frames.forEach(t=>{s.addFrame(t.canvas,{delay:200})}),s.on("finished",t=>{console.log("finished"),window.open(URL.createObjectURL(t))}),s.render(),console.log(s),document.querySelector("main").appendChild(e)}}class z{constructor(t){this.frames=t,this.gifCreator=new E(this),this.content=a("div",{display:"flex",flexDirection:"column",padding:"0",minWidth:"100px",margin:"0 10px 10px 10px"},"player"),this.player_canvas_container=a("div",{width:"192px",height:"192px",border:"2px solid yellow",display:"flex",justifyContent:"center",alignItems:"center"},"__player-canvas-container"),this.player_canvas=a("canvas",{width:"32px",height:"32px",margin:"auto",imageRendering:"pixelated"},"_canvas"),this.player_canvas.width=32,this.player_canvas.height=32,this.canvas_size=32,this.ctx=this.player_canvas.getContext("2d"),this.speed=parseInt(localStorage.getItem("player_speed"))||12,this.speed_node=a("span",{fontSize:"1.2rem",color:"black",textAlign:"center",margin:"5px 0"},"_speed"),this.speed_node.innerHTML=`${this.speed} x `,this.input=a("input",{margin:"2px 0"},"_range"),this.input.min="0",this.input.max="24",this.input.type="range",this.input.value=this.speed,this.interval=null,this.index=0,this.full_screen=!1,this.canvasSizeConteiner=a("div",{display:"flex",flexDirection:"row",height:"50px",marginBottom:"5px"},"__change-canvas-size"),[1,6,"Full"].forEach(t=>{const e=a("button",{width:"100%",height:"50px",margin:"0 5px 0 5px"},"__item");e.innerHTML=t,1===t&&(e.dataset.size=32),6===t&&(e.dataset.size=192),"Full"===t&&(e.dataset.size="full"),e.addEventListener("click",this.changeSize.bind(this)),this.canvasSizeConteiner.appendChild(e)}),this.menu=a("div",{display:"flex",flexDirection:"row",height:"70px"},"__menu"),this.saveGif=a("button",{width:"60px",height:"60px"},"__saveGIf"),this.content.appendChild(this.canvasSizeConteiner)}changeSize(t){const e=t.target.dataset.size;parseInt(e)?(this.canvas_size=parseInt(e),this.changeCanvasSize(parseInt(e))):this.player_canvas_container.requestFullscreen()}fullScreenHandle(){this.full_screen?(this.full_screen=!1,this.changeCanvasSize(this.canvas_size)):(this.full_screen=!0,this.changeCanvasSize(512))}changeCanvasSize(t){this.player_canvas.style.width=`${t}px`,this.player_canvas.style.height=`${t}px`}update_speed_node(){this.speed_node.innerHTML=`${this.speed} x`}animate(){const t=this.frames;this.index>=t.length&&(this.index=t.length-1);const e=t[this.index].get_image_data(),s=new Image(this.canvas_size,this.canvas_size);s.src=e,s.onload=()=>{this.ctx.clearRect(0,0,this.canvas_size,this.canvas_size),this.ctx.drawImage(s,0,0)};const a=this.index+1>=t.length?0:this.index+1;this.index=a}start(){this.player_canvas_container.appendChild(this.player_canvas),this.content.appendChild(this.player_canvas_container),this.content.appendChild(this.speed_node),this.content.appendChild(this.input),this.menu.appendChild(this.saveGif),this.content.appendChild(this.menu),document.querySelector("main").appendChild(this.content),this.input.addEventListener("change",t=>{this.speed=t.target.value,this.update_speed_node(),window.clearInterval(this.interval),0!=this.speed&&(this.interval=setInterval(this.animate.bind(this),Math.floor(1e3/this.speed)))}),this.interval=setInterval(this.animate.bind(this),Math.floor(1e3/this.speed)),document.addEventListener("fullscreenchange",this.fullScreenHandle.bind(this)),this.saveGif.addEventListener("click",this.gifCreator.createGif)}}class A{constructor(t,e){this.app=t,this.content=a("div",{},"frames-container"),this.conteiner=a("div",{},"__frames"),this.add_frame_button=a("button",{},"__add-frame"),this.add_frame_button.innerHTML="Add Frame",this.frames=[],this.selected=parseInt(e.selected_frame)||0,this.canvas=new I(this),this.player=new z(this.frames),this.get_selected_frame=this.get_selected_frame.bind(this),this.fake_node=a("div",{},"__fake-node")}start(){this.canvas.start(),localStorage.getItem("frames")&&(this.frames=localStorage.getItem("frames").split("###").map((t,e)=>{const s=new p(this,e);return s.put_image_data.call(s,t),e===this.selected&&(this.canvas.reload_canvas(t),this.canvas.frame=s),s})),this.player.frames=this.frames,document.querySelector("main").appendChild(this.content),this.content.appendChild(this.conteiner),this.content.appendChild(this.add_frame_button),this.frames.length?this.redraw():this.addFrame(),this.add_frame_button.addEventListener("click",this.addFrame.bind(this)),this.conteiner.addEventListener("click",this.handle_click.bind(this)),this.conteiner.addEventListener("mousedown",this.start_move.bind(this));const t=this.frames[this.selected];this.add_selection(t),this.player.start(),this.canvas.transform.start(),this.content.onunload=()=>{const t=this.frames.reduce((t,e)=>{const s=t;return s.push(e.get_image_data.call(e)),s},[]);localStorage.setItem("frames",t.join("###")),localStorage.setItem("selected_frame",this.selected)}}get_selected_frame(){return this.frames[this.selected]}addFrame(){const t=this.frames.length+1,e=new p(this,t);this.frames.push(e),this.redraw()}delete_all_frames(){const t=this.conteiner;for(;t.firstChild;)t.firstChild.remove()}redraw(){const t=this.conteiner;this.frames.map((e,s)=>(e.render(s+1,t),e))}remove_selection(){this.frames[this.selected].remove_selection()}add_selection(t){t.add_selection(),this.canvas.reload_canvas(t.get_image_data())}set_frame(t){const e=t.dataset.position||t.parentNode.dataset.position;this.remove_selection(),this.selected=e-1;const s=this.frames[this.selected];this.canvas.frame=s,this.add_selection(s)}copy_frame(t){this.delete_all_frames();const e=this.frames[t],s=new p(this,t),a=new Image;a.src=e.get_image_data(),a.onload=()=>s.ctx.drawImage(a,0,0);const n=this.frames.slice(0,t+1);n.push(s);const i=this.frames.slice(t+1);this.frames=n.concat(i),this.player.frames=this.frames,this.redraw()}delete_frame(t){const e=this.frames[t-1]?this.frames[t-1]:this.frames[t+1];this.delete_all_frames();const s=this.frames.slice(0,t),a=this.frames.slice(t+1);this.frames=s.concat(a),this.selected=t-1,this.player.frames=this.frames,this.redraw(),this.add_selection(e),this.canvas.frame=e}add_frame_to_position(t,e){const s=t,a=e,n=this.frames[s],i=this.frames[a];this.frames[s]=i,this.frames[a]=n,this.selected=a,this.canvas.frame=n,this.redraw(),this.player.frames=this.frames}get_frame_by_index(t){const e=this.frames.slice(0,t+1),s=e.pop(),a=this.frames.slice(t+1);return this.frames=e.concat(a),this.player.frames=this.frames,s}start_move(t){if("__move"===t.target.className){this.set_frame(t.target.parentNode);const e=t.target.parentNode,s=t.pageY,a=this.conteiner.offsetHeight,n=this.conteiner.offsetTop-e.offsetTop,i=this.conteiner.offsetTop+a-e.offsetTop-96;e.style.position="absolute",e.style.zIndex="100";const r=e.dataset.position-1;let o=0;const c=t=>{o=t-s,o>=n&&o<=i&&(e.style.top=`${o}px`)},l=t=>c(t.pageY);window.addEventListener("mousemove",l);const h=()=>{window.removeEventListener("mousemove",l);const t=Math.floor(a/this.frames.length),s=Math.round(o/t);e.style.zIndex="",this.add_frame_to_position(r,r+s),window.removeEventListener("mouseup",h)};window.addEventListener("mouseup",h)}}handle_click(t){const e=t.target.className;if("__item"===e||"__item"===t.target.parentNode.className)this.set_frame.call(this,t.target);else if("__copy"===e){const e=t.target.parentNode.dataset.position-1;this.copy_frame(e)}else if("__delete"===e){const e=t.target.parentNode.dataset.position-1;this.delete_frame(e)}}}new class{constructor(t){this.pensize=t.pensize||4,this.current_color=t.current_color||"#000001",this.previous_color=t.previous_color||"#ffffff",this.instrument=t.instrument||"pencil",this.image_data=t.image_data||null,this.canvas_size=t.canvas_size||512,this.pensize_controll=new n(this),this.color_controll=new c(this),this.frames=new A(this,t),this.data_menu=new h(this),this.instrument_control=new d(this,t)}start(){this.instrument_control.start(),this.pensize_controll.start(),this.color_controll.start(),this.frames.start(),window.onunload=()=>{const t=this.frames.frames.reduce((t,e)=>{const s=t;return s.push(e.get_image_data.call(e)),s},[]);localStorage.setItem("instrument",this.instrument),localStorage.setItem("current_color",this.current_color),localStorage.setItem("previous_color",this.previous_color),localStorage.setItem("pensize",this.pensize),localStorage.setItem("frames",t.join("###")),localStorage.setItem("selected_frame",this.frames.selected),localStorage.setItem("player_speed",this.frames.player.speed),localStorage.setItem("canvas_size",this.canvas_size)}}}({pensize:localStorage.getItem("pensize"),current_color:localStorage.getItem("current_color"),previous_color:localStorage.getItem("previous_color"),instrument:localStorage.getItem("instrument"),frames:localStorage.getItem("frames"),selected_frame:localStorage.getItem("selected_frame")}).start()},function(t,e){}]);